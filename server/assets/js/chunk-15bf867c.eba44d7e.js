(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-15bf867c"],{"34fe":function(t,e,r){"use strict";var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{ref:"tabWraper",staticClass:"tabWraper"},[r("ul",{ref:"tabContent",staticClass:"content",style:t.style[t.tabPos]},t._l(t.tabs,function(e,n){return r("li",{key:n,ref:"tabItem",refInFor:!0,staticClass:"tabItem",on:{click:function(r){t.Tab(e,n)}}},[r("div",{staticClass:"text",class:{tabActive:t.sIndex===n}},[t._v(t._s(e[t.label]))])])}))])},a=[],i=r("1fba"),s={props:{index:0,data:{type:Array,default:null},onTab:{type:Function,default:null},tabPos:{type:String,default:"left"},label:{type:String,default:"name"}},data:function(){return{sIndex:0,tabs:this.data,style:{left:"justify-content:start;",center:"justify-content: center;",right:"justify-content: end;"}}},methods:{getChildrenWidth:function(t){for(var e=t.children,r=0,n=0;n<e.length;n++)r+=e[n].offsetWidth;return r},createScroll:function(){var t=this.getChildrenWidth(this.$refs.tabContent);this.$refs.tabContent.style.width=t+"px",this.scroll=new i["a"](this.$refs.tabWraper,{preventDefault:!0,startX:0,click:!0,scrollX:!0,scrollY:!1,eventPassthrough:"vertical"})},initScroll:function(){this.scroll?this.scroll.refresh():this.createScroll()},Tab:function(t,e){this.sIndex=e,this.onTab&&this.onTab(t,e)},initState:function(){this.sIndex=this.index?this.index:0,this.initScroll()}},created:function(){var t=this;window.onresize=function(){t.createScroll()}},mounted:function(){this.initState()},watch:{data:function(t){this.tabs=t,this.initState()}}},o=s,c=(r("8a55"),r("2877")),u=Object(c["a"])(o,n,a,!1,null,"8f6cc2bc",null);u.options.__file="ScrollTab.vue";e["a"]=u.exports},4165:function(t,e,r){"use strict";r("e7e5");var n=r("d399"),a=(r("c5f6"),r("96cf"),r("1da1"));r("a481"),r("4917");function i(t,e){var r={timeStamp:t.timeStamp,nonceStr:t.nonceStr,package:t.prepayId,paySign:t.paySign},n=new Promise(function(t,n){t(0==e?0:r)});return n}e["a"]=function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(e,r,a,s,o){var c,u;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(a=Number(a),console.log(a,"_----"),0!==a){t.next=4;break}return t.abrupt("return",a);case 4:return c={usrId:e.Storage.get("USER_INFO").usrId,paymentCode:"D_WEIXIN",tradeTypeCode:"JSAPI",paymentTypeCode:o||"D_FULL",shopCode:e.Storage.get("USER_INFO").shopCode,orderList:r,orderType:s||null,openId:e.Storage.get("WECHAT_INFO").openid,payAmount:Number(a),unionId:Storage.get("properties").publicAccount},console.log(a,"===="),t.next=8,e.$post("payment/orderPayment",c);case 8:if(u=t.sent,"200"!==u.code){t.next=13;break}return t.abrupt("return",i(u,a));case 13:return Object(n["a"])(u.message),t.abrupt("return",Promise.reject());case 15:case"end":return t.stop()}},t,this)}));return function(e,r,n,a,i){return t.apply(this,arguments)}}()},"4a98":function(t,e,r){"use strict";var n=r("18a0"),a=r.n(n),i={miniProgramPay:function(t,e,r){var n={timeStamp:t.timeStamp,nonceStr:t.nonceStr,package:t.package,paySign:t.paySign,successUrl:e,failUrl:r||"/show"},i={config:n};a.a.miniProgram.navigateTo({url:"/page/pay/pay?payData="+encodeURIComponent(JSON.stringify(i))})},WebPay:function(t,e,r,n){a.a.config({debug:!1,appId:t.appId,timestamp:t.timestamp,nonceStr:t.nonceStr,signature:t.signature,jsApiList:["chooseWXPay"]}),a.a.chooseWXPay({timestamp:e.timestamp,nonceStr:e.nonceStr,package:e.package,signType:e.signType,paySign:e.paySign,success:function(t){if(-1===r.indexOf("http://")&&-1===r.indexOf("https://"))window.location.protocol,window.location.host,window.location.pathname;else window.location.href=r},error:function(t){if(-1===n.indexOf("http://")&&-1===n.indexOf("https://"))window.location.protocol,window.location.host,window.location.pathname;else window.location.href=n}})}};e["a"]=i},"6e92":function(t,e,r){},7313:function(t,e,r){"use strict";var n=r("bbb2"),a=r.n(n);a.a},"7c6b":function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"flex-vbox w100 h100"},[r("div",{staticClass:"flex-auto"},[r("card-swiper",{attrs:{cards:t.cards,showPopup:t.showPurchase},on:{onSwiper:t.getCurrentCardInfo,"update:showPopup":function(e){t.showPurchase=e}}}),t.showGrowthValue?r("div",{staticClass:"grow-up"},[r("div",{staticClass:"grow-fr"},[r("span",{staticClass:"grow-name"},[t._v("成长值")]),r("span",{staticClass:"grow-val"},[t._v(t._s(t.userVipLevelInfo.haveConsume))]),r("span",{staticClass:"grow-tip"},[t._v("（还需消费"+t._s(t.userVipLevelInfo.needConsume)+"元升级至"+t._s(t.userVipLevelInfo.nextLevelName)+"）")])]),r("div",{staticClass:"grow-mel"},[r("van-progress",{attrs:{"pivot-text":t.userVipLevelInfo.haveConsume,color:"#f44",percentage:t.percentage}})],1),r("div",{staticClass:"grow-btm"},[r("span",{staticClass:"left"},[t._v("0")]),r("span",{staticClass:"right"},[t._v(t._s(t.userVipLevelInfo.mostConsume))])])]):t._e(),t.hasTheCard?r("div",{staticClass:"content pd30 fs36B"},[r("p",[t._v("我的特权")]),r("div",{staticClass:"fs28 pdTb10",domProps:{innerHTML:t._s(t.curCardLevelInfo.lable)}})]):t._e(),t.hasTheCard?t._e():r("div",{staticClass:"content pd30 fs36B"},[r("p",[t._v("未开通")])])],1),r("van-popup",{attrs:{position:"bottom",overlay:t.showPurchase},model:{value:t.showPurchase,callback:function(e){t.showPurchase=e},expression:"showPurchase"}},[r("div",{staticClass:"cardPopup"},[t._v(t._s(t.curCardLevelInfo.cardLevelName))]),t._l(t.discountList,function(e,n){return r("div",{key:n,staticClass:"flex-between h100px flex-vcenter pdLr30"},[r("div",{staticClass:"fs28"},[t._v(t._s(e.valiPeriod))]),r("div",[r("span",{staticClass:"fs28B color-red"},[t._v("¥ "+t._s(e.price))]),r("span",{staticClass:"bg-black mgL30 fs28 white pdTb10 pdLr20",on:{click:function(r){t.Purchase(e)}}},[t._v("购买")])])])}),r("div",{staticClass:"flex-center fs30 h100px bg-gray",on:{click:function(e){t.TogglePurchase("cancel")}}},[t._v("取消")])],2)],1)},a=[],i=(r("96cf"),r("1da1")),s=(r("ac6a"),r("5548"),r("9285"),r("fe7e")),o=Object(s["a"])({render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{class:t.b()},[r("span",{class:t.b("portion",{"with-pivot":t.showPivot&&t.text}),style:t.portionStyle},[t.showPivot&&t.text?r("span",{ref:"pivot",class:t.b("pivot"),style:t.pivotStyle},[t._v(t._s(t.text))]):t._e()])])},name:"progress",props:{inactive:Boolean,pivotText:String,pivotColor:String,percentage:{type:Number,required:!0,validator:function(t){return t>=0&&t<=100}},showPivot:{type:Boolean,default:!0},color:{type:String,default:"#38f"},textColor:{type:String,default:"#fff"}},data:function(){return{pivotWidth:0,progressWidth:0}},computed:{text:function(){return this.isDef(this.pivotText)?this.pivotText:this.percentage+"%"},currentColor:function(){return this.inactive?"#cacaca":this.color},pivotStyle:function(){return{color:this.textColor,background:this.pivotColor||this.currentColor}},portionStyle:function(){return{width:(this.progressWidth-this.pivotWidth)*this.percentage/100+"px",background:this.currentColor}}},mounted:function(){this.getWidth()},watch:{showPivot:function(){this.getWidth()},pivotText:function(){this.getWidth()}},methods:{getWidth:function(){this.progressWidth=this.$el.offsetWidth,this.pivotWidth=this.$refs.pivot?this.$refs.pivot.offsetWidth:0}}}),c=(r("8a58"),r("e41f")),u=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{ref:"scrollWraper",staticClass:"wheel-wrapper"},[r("div",{ref:"cardWraper",staticClass:"wheel-scroll"},[t._l(t.cards,function(e,n){return[r("card",{key:n,attrs:{card:e},on:{openVip:t.openVip}})]})],2)])},d=[],l=r("1fba"),p=r("bf3c"),h=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"card-wrapper"},[r("div",{staticClass:"gold-card",class:{"blackCard ":!t.card.vipCardImage},style:t.vipCardImg},[r("div",{staticClass:"pd30 fs40B"},[r("span",{staticClass:"vip-img"}),r("span",{staticClass:"fs28"},[t._v(t._s(t.card.cardLevelName))])]),t.card.usrName?t._e():r("div",{staticClass:"flex-between pd30 fs28"},[r("div",{staticClass:"bottom-right"},[t.card.cardAmount?r("span",{staticClass:"add-to-wechat",on:{click:function(e){e.stopPropagation(),t.openVip()}}},[t._v("立即开通")]):t._e()])]),t.card.usrName?r("div",{staticClass:"flex-between pd30 fs28"},[r("div",{staticClass:"bottom-left"},[r("span",[t._v(t._s(t.card.usrName))]),r("span",[t._v(t._s(t.effectDate))])]),t.canAddToWxCardPkgs?r("div",{staticClass:"bottom-right",on:{click:function(e){e.stopPropagation(),t.addToWechatCardPkg()}}},[r("span",{staticClass:"add-to-wechat"},[t._v("加入微信卡包")])]):t._e()]):t._e()])])},f=[],v=(r("28a5"),r("cb66")),g=r("8974"),C=r("6098"),m=r("18a0"),w=r.n(m),b={props:{index:{default:0},card:{default:function(){return{}}}},data:function(){return{cardInfo:{}}},methods:{openVip:function(){this.$emit("openVip",!0)},getVipCardInfo:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e={wxUnionid:Storage.get("properties").publicAccount},t.abrupt("return",C["getMyCardInfo"](e));case 2:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),getCardConfig:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(e){var r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return r={card_id:e,code:this.card.cardLevelCode,isNeedOpenid:0,wxuuid:Storage.get("properties").publicAccount},console.log(this.card.cardLevelName,r),t.abrupt("return",v["getWxconfig"](r));case 3:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),getWxConfig:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(){var e,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=window.location.href.split("#")[0],r={wxUUID:Storage.get("properties").publicAccount,unAuthorizedUrl:encodeURIComponent(e)},t.abrupt("return",g["getWxSignature"](r));case 3:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),wxInit:function(t,e,r){w.a.config({debug:!1,appId:t.appId,timestamp:t.timeStamp,nonceStr:t.nonceStr,signature:t.signature,jsApiList:["addCard"]}),w.a.ready(function(){w.a.addCard({cardList:[{cardId:e,cardExt:JSON.stringify(r)}],success:function(t){Toast("添加成功~");t.cardList},error:function(t){Toast("添加失败~",t),console.error("err",t)}}),w.a.error(function(t){console.error("err",t)})})},addToWechatCardPkg:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(){var e=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.getVipCardInfo();case 2:this.cardInfo=t.sent,this.$requestAll([this.getWxConfig(),this.getCardConfig(this.cardInfo.wxId)]).then(function(t){console.log("request",t),e.wxInit(t[0],e.cardInfo.wxId,t[1])});case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},computed:{effectDate:function(){return 0==this.card.validTerm?"长期有效":p["a"].isEmpty(this.card.expireDate)?null:this.card.expireDate.split(" ")[0]+"到期"},vipCardImg:function(){return this.card.vipCardImage?{background:"url("+getImg(this.card.vipCardImage)+")","background-size":"100% 100%"}:{}},isTopLevel:function(){return!(!this.card.usrName||1!=this.card.priorityFlag)},canAddToWxCardPkgs:function(){return!!this.cardInfo.wxId&&(0!=this.cardInfo.isSynctowx&&1==this.card.toWxCardFlag)}}},I=b,x=(r("f098"),r("2877")),y=Object(x["a"])(I,h,f,!1,null,"46ec68a4",null);y.options.__file="card.vue";var _=y.exports,S={components:{card:_},props:{cards:{type:Array,default:[]},showPopup:!1},data:function(){return{isReady:!1}},methods:{getChildrenWidth:function(t){for(var e=t.children,r=0,n=0;n<e.length;n++)r+=e[n].clientWidth;return r},createScroll:function(){var t=this,e=this.getChildrenWidth(this.$refs.cardWraper),r=this.$refs.cardWraper.children[0].clientWidth;this.$refs.cardWraper.style.width=e+20+"px",this.scroll=new l["a"](this.$refs.scrollWraper,{startX:0,click:!1,scrollX:!0,scrollY:!1,eventPassthrough:"vertical",snap:{loop:!1,threshold:.1,stepX:r,stepY:100}}),this.scroll.on("scrollEnd",function(){var e=t.scroll.getCurrentPage();t.$emit("onSwiper",e.pageX)})},initScroll:function(){this.scroll?this.scroll.refresh():this.createScroll()},openVip:function(){this.$emit("update:showPopup",!0)}},created:function(){var t=this;window.onresize=function(){t.createScroll()}},updated:function(){this.initScroll()}},L=S,P=(r("caa5"),Object(x["a"])(L,u,d,!1,null,"a89aac66",null));P.options.__file="card-swiper.vue";var k=P.exports,W=r("34fe"),T=r("4165"),O=r("4a98"),V=r("22ce"),N={components:{cardSwiper:k,"van-popup":c["a"],"van-progress":o,scrollTab:W["a"]},data:function(){return{show:!1,curIndex:-1,cards:[],userVipLevelInfo:{},curCardLevelInfo:{},cardLevelInfoCache:{},curCardPriceList:[],cardPriceListCache:[],showPurchase:!1,active:0,btnPay:"立即购买"}},methods:{getCards:function(){var t={shopCode:this.Storage.get("USER_INFO").shopCode,busContsCode:baseConstant.busContsCode};return C["getCardLevelList"](t).catch(function(t){return[]})},sortCards:function(t){return t.forEach(function(e,r){e.usrName&&(t.splice(r,1),t.unshift(e))}),t},getUserNextVipLevelInfo:function(){var t={usrId:Storage.get("USER_INFO").usrId,ownCompanyId:Storage.get("COMPANYID").company_id,companyId:Storage.get("COMPANYID").company_id};return V["m"].getVipLevel(t)},addValiPeriodField:function(t){return t.forEach(function(t){0==t.validityTerm?t.valiPeriod="永久有效":t.valiPeriod=t.validityTerm+"个月"}),t},getCardPriceList:function(t){var e={shopCode:this.Storage.get("USER_INFO").shopCode,busContsCode:baseConstant.busContsCode,cardLevelCode:this.cards[t].cardLevelCode};return C["getCardVouchers"](e)},getCurrentCardInfo:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(e){var r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.curIndex!==e){t.next=2;break}return t.abrupt("return");case 2:if(this.curIndex=e,r={code:this.cards[e].cardLevelCode},!p["a"].isEmpty(this.cardLevelInfoCache[e])){t.next=17;break}return t.next=7,C["getCardLevelDetail"](r);case 7:return this.curCardLevelInfo=t.sent,this.cardLevelInfoCache[e]=this.curCardLevelInfo,t.t0=this,t.next=12,this.getCardPriceList(e);case 12:t.t1=t.sent,this.curCardPriceList=t.t0.addValiPeriodField.call(t.t0,t.t1),this.cardPriceListCache[e]=this.curCardPriceList,t.next=19;break;case 17:this.curCardLevelInfo=this.cardLevelInfoCache[e],this.curCardPriceList=this.cardPriceListCache[e];case 19:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),TogglePurchase:function(t){switch(t){case"purchase":this.showPurchase=!0;break;case"cancel":this.showPurchase=!1;break;default:this.showPurchase=!1;break}},Purchase:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(e){var r,n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return r={shopCode:this.Storage.get("USER_INFO").shopCode,cardLevelCode:this.cards[this.curIndex].cardLevelCode,valiDityTerm:e.validityTerm},t.next=3,C["buyCard"](r);case 3:n=t.sent,Object(T["a"])(this,n,e.price,"D_CARDORD").then(function(t){O["a"].miniProgramPay(t,"/member-ship","/member-ship")});case 5:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),onInit:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.t0=this,t.next=3,this.getCards();case 3:return t.t1=t.sent,this.cards=t.t0.sortCards.call(t.t0,t.t1),t.next=7,this.getUserNextVipLevelInfo();case 7:this.userVipLevelInfo=t.sent,this.getCurrentCardInfo(0);case 9:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},computed:{hasTheCard:function(){if(this.curIndex<0)return!1;var t=p["a"].isEmpty(this.cards[this.curIndex].usrName);return this.btnPay=t?"立即购买":"续费",!t},discountList:function(){return p["a"].isEmpty(this.curCardPriceList)?[{validityTerm:this.curCardLevelInfo.addEffTime,price:this.curCardLevelInfo.cardAmount}]:this.curCardPriceList},percentage:function(){return this.userVipLevelInfo?this.userVipLevelInfo.haveConsume/this.userVipLevelInfo.mostConsume*100:0},showGrowthValue:function(){return!!this.userVipLevelInfo&&(0!=this.userVipLevelInfo.effFlag&&(!this.userVipLevelInfo.noRuleFlag&&(!(this.curIndex<0)&&this.cards[this.curIndex].id==this.userVipLevelInfo.nextLevelId)))}},created:function(){this.onInit()}},R=N,E=(r("7313"),Object(x["a"])(R,n,a,!1,null,"40ea7816",null));E.options.__file="member-ship.vue";e["default"]=E.exports},"8a55":function(t,e,r){"use strict";var n=r("a7b0"),a=r.n(n);a.a},9285:function(t,e,r){},a7b0:function(t,e,r){},bbb2:function(t,e,r){},caa5:function(t,e,r){"use strict";var n=r("6e92"),a=r.n(n);a.a},da99:function(t,e,r){},f098:function(t,e,r){"use strict";var n=r("da99"),a=r.n(n);a.a}}]);