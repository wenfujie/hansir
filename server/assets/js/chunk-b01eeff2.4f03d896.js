(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b01eeff2"],{"0bcf":function(t,e,s){},4165:function(t,e,s){"use strict";s("e7e5");var a=s("d399"),n=(s("c5f6"),s("96cf"),s("1da1"));s("a481"),s("4917");function i(t,e){var s={timeStamp:t.timeStamp,nonceStr:t.nonceStr,package:t.prepayId,paySign:t.paySign},a=new Promise(function(t,a){t(0==e?0:s)});return a}e["a"]=function(){var t=Object(n["a"])(regeneratorRuntime.mark(function t(e,s,n,r,o){var c,u;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(n=Number(n),console.log(n,"_----"),0!==n){t.next=4;break}return t.abrupt("return",n);case 4:return c={usrId:e.Storage.get("USER_INFO").usrId,paymentCode:"D_WEIXIN",tradeTypeCode:"JSAPI",paymentTypeCode:o||"D_FULL",shopCode:e.Storage.get("USER_INFO").shopCode,orderList:s,orderType:r||null,openId:e.Storage.get("WECHAT_INFO").openid,payAmount:Number(n),unionId:Storage.get("properties").publicAccount},console.log(n,"===="),t.next=8,e.$post("payment/orderPayment",c);case 8:if(u=t.sent,"200"!==u.code){t.next=13;break}return t.abrupt("return",i(u,n));case 13:return Object(a["a"])(u.message),t.abrupt("return",Promise.reject());case 15:case"end":return t.stop()}},t,this)}));return function(e,s,a,n,i){return t.apply(this,arguments)}}()},"4a98":function(t,e,s){"use strict";var a=s("18a0"),n=s.n(a),i={miniProgramPay:function(t,e,s){var a={timeStamp:t.timeStamp,nonceStr:t.nonceStr,package:t.package,paySign:t.paySign,successUrl:e,failUrl:s||"/show"},i={config:a};n.a.miniProgram.navigateTo({url:"/page/pay/pay?payData="+encodeURIComponent(JSON.stringify(i))})},WebPay:function(t,e,s,a){n.a.config({debug:!1,appId:t.appId,timestamp:t.timestamp,nonceStr:t.nonceStr,signature:t.signature,jsApiList:["chooseWXPay"]}),n.a.chooseWXPay({timestamp:e.timestamp,nonceStr:e.nonceStr,package:e.package,signType:e.signType,paySign:e.paySign,success:function(t){if(-1===s.indexOf("http://")&&-1===s.indexOf("https://"))window.location.protocol,window.location.host,window.location.pathname;else window.location.href=s},error:function(t){if(-1===a.indexOf("http://")&&-1===a.indexOf("https://"))window.location.protocol,window.location.host,window.location.pathname;else window.location.href=a}})}};e["a"]=i},"63a5":function(t,e,s){},"8a3e":function(t,e,s){},9053:function(t,e,s){"use strict";var a=s("0bcf"),n=s.n(a);n.a},de2a:function(t,e,s){"use strict";var a=s("63a5"),n=s.n(a);n.a},e2a8:function(t,e,s){"use strict";var a=s("8a3e"),n=s.n(a);n.a},ec8b:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"vouchers-list"},[s("van-pull-refresh",{attrs:{"head-height":100},on:{refresh:t.onRefresh},model:{value:t.isLoading,callback:function(e){t.isLoading=e},expression:"isLoading"}},[s("voucherList",{attrs:{cardList:t.cardList}}),s("empty",{directives:[{name:"show",rawName:"v-show",value:t.showEmpty,expression:"showEmpty"}],attrs:{emptyText:"暂无优惠券可领~"}})],1)],1)},n=[],i=(s("ac6a"),s("96cf"),s("1da1")),r=(s("ab71"),s("58e6")),o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"page-coupon"},t._l(t.cardList,function(t,e){return s("voucher",{key:e,attrs:{card:t}})}))},c=[],u=(s("c5f6"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.isDisCoupon?s("div",{staticClass:"mgB30"},[s("div",{staticClass:"coupon flex-box"},[s("div",{staticClass:"left flex-center"},[s("div",[s("span",{staticClass:"fs48B"},[t._v(t._s(t.card.couponValue))]),s("span",{staticClass:"fs24"},[t._v(" 折")])])]),s("div",{staticClass:"center flex-auto flex-vbox flex-between pdTb20"},[s("p",{staticClass:"fs28B"},[t._v(t._s(t.card.couponName))]),s("div",{staticClass:"fs26"},[2===t.card.state?s("span",[t._v("已过期  ")]):t._e(),s("span",{staticClass:"GREY.grey99 fs24"},[t._v(t._s(t.valiPeriod))])]),s("div",{staticClass:"fs24 GREY.grey99",on:{click:function(e){t.showUsage()}}},[t._v("\n                    使用说明\n                    "),s("i",{class:["iconfont icon-down ",{rotatingUp:t.showDesc,rotatingDown:!t.showDesc}]})])]),s("div",{staticClass:"right"},[t.operation.showPrice?s("div",{staticClass:"salePrice"},[t._v("售"+t._s(t.card.buyPrice)+"元")]):t._e(),s("div",{staticClass:"button flex-center",on:{click:function(e){t.operate()}}},[t._v(t._s(t.operation.name))])])]),t.showDesc?s("div",{staticClass:"describe"},[t._v(t._s(t.card.couponLimit))]):t._e()]):t._e(),t.isCashCoupon?s("div",{staticClass:"mgB30"},[s("div",{staticClass:"coupon flex-box"},[s("div",{staticClass:"left flex-center"},[s("div",[s("span",{staticClass:"fs24"},[t._v("¥ ")]),s("span",{staticClass:"fs36B"},[t._v(t._s(t.card.couponValue)+"元")])])]),s("div",{staticClass:"center flex-auto flex-vbox flex-between pdTb20"},[s("p",{staticClass:"fs28B"},[t._v(t._s(t.card.couponName))]),s("div",{staticClass:"fs26"},[2===t.card.state?s("span",[t._v("已过期  ")]):t._e(),s("span",{staticClass:"GREY.grey99 fs24"},[t._v(t._s(t.valiPeriod))])]),s("div",{staticClass:"fs24 GREY.grey99",on:{click:function(e){t.showUsage()}}},[t._v("\n                    使用说明\n                    "),s("i",{class:["iconfont icon-down ",{rotatingUp:t.showDesc,rotatingDown:!t.showDesc}]})])]),s("div",{staticClass:"right flex-vbox"},[t.operation.showPrice?s("div",{staticClass:"salePrice"},[t._v("售 "+t._s(t.card.buyPrice)+" 元")]):t._e(),s("div",{staticClass:"button flex-center",on:{click:function(e){t.operate()}}},[t._v(t._s(t.operation.name))])])]),t.showDesc?s("div",{staticClass:"describe"},[t._v(t._s(t.card.couponLimit))]):t._e()]):t._e(),t.isOnceCard?s("div",{staticClass:"mgB30"},[s("div",{staticClass:"coupon flex-box"},[s("div",{staticClass:"left flex-vbox flex-center"},[s("div",[s("span",{staticClass:"fs24"},[t._v("¥ ")]),s("span",{staticClass:"fs36B"},[t._v(t._s(t.card.couponValue))])])]),s("div",{staticClass:"center flex-auto flex-vbox flex-between pdTb20"},[s("p",{staticClass:"fs28B"},[t._v(t._s(t.card.couponName))]),s("div",{staticClass:"fs26"},[2===t.card.state?s("span",[t._v("已过期  ")]):t._e(),s("span",{staticClass:"GREY.grey99 fs24"},[t._v(t._s(t.valiPeriod))])]),s("div",{staticClass:"fs24 GREY.grey99",on:{click:function(e){t.showUsage()}}},[t._v("\n                    使用说明\n                    "),s("i",{class:["iconfont icon-down",{rotatingUp:t.showDesc,rotatingDown:!t.showDesc}]})])]),s("div",{staticClass:"right flex-vbox"},[t.operation.showPrice?s("div",{staticClass:"salePrice"},[t._v("售"+t._s(t.card.buyPrice)+"元")]):t._e(),s("div",{staticClass:"button flex-center",on:{click:function(e){t.operate()}}},[t._v(t._s(t.operation.name))])])]),t.showDesc?s("div",{staticClass:"describe"},[t._v(t._s(t.card.couponLimit))]):t._e()]):t._e(),t.isStoredCard?s("div",{staticClass:"mgB30"},[s("div",{staticClass:"coupon flex-box"},[s("div",{staticClass:"left flex-vbox flex-center"},[s("div",[s("span",{staticClass:"fs24"},[t._v("¥ ")]),s("span",{staticClass:"fs36B"},[t._v(t._s(t.card.couponValue))])])]),s("div",{staticClass:"center flex-auto flex-vbox flex-between pdTb20"},[s("p",{staticClass:"fs28B"},[t._v(t._s(t.card.couponName))]),s("div",{staticClass:"fs26"},[2===t.card.state?s("span",[t._v("已过期  ")]):t._e(),s("span",{staticClass:"GREY.grey99 fs24"},[t._v(t._s(t.valiPeriod))])]),s("div",{staticClass:"fs24 GREY.grey99",on:{click:function(e){t.showUsage()}}},[t._v("\n                    使用说明\n                    "),s("i",{class:["iconfont icon-down",{rotatingUp:t.showDesc,rotatingDown:!t.showDesc}]})])]),s("div",{staticClass:"right flex-vbox"},[t.operation.showPrice?s("div",{staticClass:"salePrice"},[t._v("售"+t._s(t.card.buyPrice)+"元")]):t._e(),s("div",{staticClass:"button flex-center",on:{click:function(e){t.operate()}}},[t._v(t._s(t.operation.name))])])]),t.showDesc?s("div",{staticClass:"describe"},[t._v(t._s(t.card.couponLimit))]):t._e()]):t._e()])}),d=[],p=(s("e7e5"),s("d399")),l=(s("456d"),s("a481"),s("28a5"),s("22ce")),f=s("4165"),v=s("4a98"),h={props:{card:Object},data:function(){return{showDesc:!1,couponNames:{D_AONETIMECARD:"一次性储值卡 ",D_CASHVOLUME:" 现金券",D_DISCOUNTCOUPONS:"折扣券",D_RECHARGEABLECARD:"充值卡"}}},computed:{valiPeriod:function(){var t=this.card.couponStartTime.split(" "),e=this.card.couponEndTime.split(" "),s=t[0].replace(/\-/g,".")+" "+t[1].substr(0,5),a=e[0].replace(/\-/g,".")+" "+e[1].substr(0,5);return s+"-"+a},isCashCoupon:function(){return"D_CASHVOLUME"===this.card.cardTypeCode},isDisCoupon:function(){return"D_DISCOUNTCOUPONS"===this.card.cardTypeCode},isStoredCard:function(){return"D_RECHARGEABLECARD"===this.card.cardTypeCode},isOnceCard:function(){return"D_AONETIMECARD"===this.card.cardTypeCode},operation:function(){return 1===this.card.isBuy&&this.card.buyPrice>0?{name:"购买",type:"buy",showPrice:!0}:0===this.card.isBuy||this.card.buyPrice<=0?{name:"领用",type:"draw",showPrice:!1}:void 0}},filters:{disFormat:function(t){return(10*t).toFixed(1)}},methods:{showUsage:function(){this.card.couponLimit&&(this.showDesc=!this.showDesc)},paramsFilter:function(t){var e=Object.keys(t);return e.forEach(function(e){t[e]||delete t[e]}),console.log("filter",t),t},draw:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(){var e,s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e={usrId:Storage.get("USER_INFO").usrId,companyId:Storage.get("COMPANYID").company_id,busContsCode:baseConstant.busContsCode,cardId:this.card.valueCardHdId,couponsId:this.card.couponId},e=this.paramsFilter(e),t.next=4,l["o"].saveCoupons(e);case 4:s=t.sent,t.t0=s[0].state,t.next="0"===t.t0?8:"1"===t.t0?11:"2"===t.t0?13:15;break;case 8:return Object(p["a"])("领取成功~"),this.$router.replace("/my-vouchers"),t.abrupt("break",17);case 11:return Object(p["a"])("您已经领取过该优惠券啦~"),t.abrupt("break",17);case 13:return Object(p["a"])("该优惠券已经被其他会员绑定~"),t.abrupt("break",17);case 15:return Object(p["a"])("领取失败~"),t.abrupt("break",17);case 17:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),buy:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(){var e,s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e={usrId:Storage.get("USER_INFO").usrId,companyId:Storage.get("COMPANYID").company_id,shopCode:Storage.get("USER_INFO").shopCode,couponsId:this.card.couponId,valuecardHdId:this.card.valueCardHdId,busContsCode:baseConstant.busContsCode},e=this.paramsFilter(e),t.next=4,l["o"].buyCoupons(e);case 4:s=t.sent,Object(f["a"])(this,s.billCode,this.card.buyPrice,"D_COUPONSORD").then(function(t){var e="/my-vouchers",s="/vouchers-list";v["a"].miniProgramPay(t,e,s)});case 6:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),operate:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:t.t0=this.operation.type,t.next="draw"===t.t0?3:"buy"===t.t0?5:7;break;case 3:return this.draw(),t.abrupt("break",8);case 5:return this.buy(),t.abrupt("break",8);case 7:return t.abrupt("break",8);case 8:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},created:function(){console.log("card",this.card.cardTypeCode)}},C=h,_=(s("9053"),s("2877")),b=Object(_["a"])(C,u,d,!1,null,"2681d621",null);b.options.__file="voucher.vue";var g=b.exports,m={props:{cardList:Array,cardState:Number},components:{voucher:g},data:function(){return{list:[]}},methods:{},watch:{cardList:function(t){console.log("watchCardList",this.cardList)}}},w=m,y=(s("de2a"),Object(_["a"])(w,o,c,!1,null,"b959fb32",null));y.options.__file="voucherList.vue";var x=y.exports,S=s("5fb8"),O={components:{voucherList:x,"van-pull-refresh":r["a"],empty:S["a"]},data:function(){return{cardList:[],isLoading:!1,showEmpty:!1}},methods:{addressSelect:function(t,e){this.infoActive=e,this.actAddressDetail=t.dptName,this.addressDetails=t.address,this.dptId=t.dptId,this.dptCode=t.dptCode,this._mapToCenter(t.lng,t.lat)},onRefresh:function(){this.getCouponList()},getCouponList:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(){var e,s,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=[],s={busContsCode:baseConstant.busContsCode,isWeixin:2,wxUnionid:Storage.get("properties").publicAccount,shopId:Storage.get("USER_INFO").shopId},t.next=4,l["o"].getVouchersList(s);case 4:a=t.sent,a&&Array.isArray(a.couponTypesList)&&a.couponTypesList.forEach(function(t){t.couponsList.forEach(function(s){s.cardTypeCode=t.couponsTypeCode,e.push(s)})}),this.cardList=e,this.isLoading=!1,0==this.cardList.length&&(this.showEmpty=!0);case 9:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},created:function(){this.getCouponList()}},D=O,I=(s("e2a8"),Object(_["a"])(D,a,n,!1,null,"756631ac",null));I.options.__file="vouchers-list.vue";e["default"]=I.exports}}]);