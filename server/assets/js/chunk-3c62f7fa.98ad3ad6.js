(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3c62f7fa"],{"526b":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"measure-data"},[a("div",{staticClass:"msr-type"},[e._m(0),a("ul",{staticClass:"msr-type-list"},e._l(e.msrTypeList,function(t){return a("li",{staticClass:"msr-type-item",class:{act:-1!==e.actTypeList.indexOf(t.measureClassInfoId)}},[a("p",{attrs:{for:t.measureClassInfoId}},[e._v(e._s(t.measureClassInfoName))]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.actTypeList,expression:"actTypeList"}],staticClass:"checkInput",attrs:{name:"msr-type",type:"checkbox",disabled:!0===e.hasOrder},domProps:{value:t.measureClassInfoId,checked:Array.isArray(e.actTypeList)?e._i(e.actTypeList,t.measureClassInfoId)>-1:e.actTypeList},on:{change:[function(a){var s=e.actTypeList,r=a.target,i=!!r.checked;if(Array.isArray(s)){var o=t.measureClassInfoId,n=e._i(s,o);r.checked?n<0&&(e.actTypeList=s.concat([o])):n>-1&&(e.actTypeList=s.slice(0,n).concat(s.slice(n+1)))}else e.actTypeList=i},e.choseType]}}),-1!==e.actTypeList.indexOf(t.measureClassInfoId)?a("div",{staticClass:"act-bg"}):e._e()])}))]),e.actualBodyData.length>0?a("div",{staticClass:"msr-actual-data"},[a("p",{staticClass:"msr-title"},[e._v("净体数据")]),a("ul",{staticClass:"msr-body-list"},e._l(e.actualBodyData,function(t){return a("li",{staticClass:"msr-body-item"},[a("span",{staticClass:"item-label"},[e._v(e._s(t.gctMeasureHdName))]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.value,expression:"item.value"}],staticClass:"item-val",attrs:{type:"number"},domProps:{value:t.value},on:{change:function(a){e.checkItem(t)},input:function(a){a.target.composing||e.$set(t,"value",a.target.value)}}})])}))]):e._e(),e._l(e.actMsrTypeList,function(t){return a("div",{staticClass:"msr-refer-data"},[a("div",{staticClass:"refer-header"},[a("div",{staticClass:"refer-header-label"},[a("label",[e._v("参照商品")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.referGoodsName,expression:"item.referGoodsName"}],staticClass:"refer-content",attrs:{type:"text",placeholder:"请输入商品号"},domProps:{value:t.referGoodsName},on:{change:function(a){e.getReferSizeList(t)},input:function(a){a.target.composing||e.$set(t,"referGoodsName",a.target.value)}}})]),a("div",{staticClass:"refer-header-label"},[a("label",[e._v("参照尺码")]),a("div",{staticClass:"refer-content"},[a("span",[e._v(e._s(t.referGoodsSize))])]),a("i",{staticClass:"iconfont icon-gengduo",on:{click:function(a){e.choseSize(t)}}})])]),a("div",{staticClass:"refer-table"},[!0===e.hasOrder?a("div",{staticClass:"order-goods refer-table-item border-none"},[a("div",{staticClass:"label"},[e._v("量体商品")]),a("div",{staticClass:"item-value border-none"},[e._v(e._s(t.ptiPartHdName))])]):e._e(),e._m(1,!0),e._l(t.referData,function(s,r){return a("div",{directives:[{name:"show",rawName:"v-show",value:!0===t.showTable,expression:"item.showTable === true"}],staticClass:"refer-table-item item-detail"},[a("div",{staticClass:"label"},[e._v(e._s(s.name))]),a("div",{staticClass:"label"},[e._v(e._s(s.referData))]),a("div",{staticClass:"item-value"},[a("div",{staticClass:"item-icon reduce-icon",on:{click:function(e){s.actualData-=1}}}),a("p",{staticClass:"item-deviation"},[e._v(e._s(e._f("Fix2")(Number(s.actualData)-Number(s.referData))))]),a("div",{staticClass:"item-icon add-icon",on:{click:function(e){s.actualData+=1}}})]),a("div",{staticClass:"label"},[e._v(e._s(s.actualData))])])})],2)])}),a("div",{staticClass:"bottom-btn-box bg-white"},[a("div",{staticClass:"btn cancel-btn",on:{click:e.goBack}},[e._v("取消")]),a("div",{staticClass:"btn confirm-btn",on:{click:e.saveMeasure}},[e._v("确定")])]),a("van-popup",{attrs:{position:"bottom"},on:{"click-overlay":e.cancelSizePopup},model:{value:e.showSizeSelect,callback:function(t){e.showSizeSelect=t},expression:"showSizeSelect"}},[a("van-picker",{staticClass:"picker-fixed",attrs:{columns:e.referSizeList,"show-toolbar":""},on:{cancel:e.cancelSizePopup,confirm:e.selectSize}})],1)],2)},r=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("p",{staticClass:"msr-title"},[e._v("选择量体类别"),a("span",[e._v("（可多选）")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"refer-table-item item-menu"},[a("div",{staticClass:"label"},[e._v("量体项目")]),a("div",{staticClass:"label"},[e._v("参考数据")]),a("div",{staticClass:"item-value"},[e._v("修改值")]),a("div",{staticClass:"label"},[e._v("量体值")])])}],i=(a("c5f6"),a("e7e5"),a("d399")),o=(a("ac6a"),a("5f5f"),a("f253")),n=(a("8a58"),a("e41f")),c=a("22ce"),l={components:{"van-popup":n["a"],"van-picker":o["a"]},data:function(){return{hasOrder:!1,saleCode:"",orderCode:"",measureCode:"",msrTypeList:[],actTypeList:[],actualBodyData:[],referSizeList:[],showSizeSelect:!1}},methods:{goBack:function(){this.$router.go(-1)},getMsrType:function(){var e=this,t={saleCode:this.saleCode};c["g"].getMeasureType(t).then(function(t){null!==t.measurePartVoList&&t.measurePartVoList.length>0&&t.measurePartVoList.forEach(function(e){e.referGoodsName="",e.referGoodsSize="",e.referGoodsId="",e.referGoodsSizeId="",e.canSelect=!1,e.showTable=!1,e.referData=[]}),e.msrTypeList=t.measurePartVoList}).then(function(){if(null!==e.msrTypeList&&e.msrTypeList.length>0&&e.msrTypeList.forEach(function(t){e.actTypeList.push(t.measureClassInfoId);var a={id:t.ptiPartHdId};c["g"].getGoodsData(a).then(function(e){e.gctPartDtMeasureVos.forEach(function(e){e.text=e.sizeName,e.value=e.id}),t.referSizeList=e.gctPartDtMeasureVos,t.useList=!1})}),e.actTypeList.length>0){var t={ids:e.actTypeList.join(","),isGetList:!0};c["g"].getBodyData(t).then(function(t){t.length>0&&t.forEach(function(e){e.value=""}),e.actualBodyData=t})}})},getDefaultMsrType:function(){var e=this,t={pageNum:0,pageSize:0};c["g"].getDefaultMeasureType(t).then(function(t){null!==t.list&&t.list.length>0&&t.list.forEach(function(e){e.measureClassInfoId=e.id,e.measureClassInfoName=e.measureClassName,e.referGoodsName="",e.referGoodsSize="",e.referGoodsId="",e.referGoodsSizeId="",e.canSelect=!1,e.showTable=!1,e.referData=[]}),e.msrTypeList=t.list})},choseType:function(){var e=this;if(!0!==this.hasOrder)if(this.actTypeList.length>0){var t=this.actTypeList.join(",");this.msrTypeList.forEach(function(a){if(-1!==t.indexOf(a.measureClassInfoId)){var s={ids:e.actTypeList.join(","),isGetList:!0};c["g"].getBodyData(s).then(function(t){t.length>0&&t.forEach(function(e){e.value=""}),e.actualBodyData=t})}})}else this.actualBodyData=[]},checkItem:function(e){1*e.value>e.maxValue||e.value<e.minValue?(Object(i["a"])("请输入"+e.minValue+"至"+e.maxValue+"的数据~"),e.value=""):e.value=Number(e.value).toFixed(1)},getReferSizeList:function(e){var t=this;e.referData=[],e.showTable=!1,e.useList=!1,e.canSelect=!1,e.referGoodsSize="";var a={partCode:e.referGoodsName};c["g"].getGoodsInfo(a).then(function(a){if(!a.partClassId)return Object(i["a"])("请输入正确的商品编码~"),void(e.referGoodsName="");var s={partClassIds:a.partClassId};c["g"].getGoodsMeasureType(s).then(function(s){if(s.length<=0||s[0].measureClassInfoId!==e.measureClassInfoId)return Object(i["a"])("请输入正确量体类型的商品~"),void(e.referGoodsName="");if(!1===t.hasOrder){var r={id:a.id};c["g"].getGoodsData(r).then(function(t){null!==t.gctPartDtMeasureVos?(t.gctPartDtMeasureVos.forEach(function(e){e.text=e.sizeName,e.value=e.id}),e.referSizeList=t.gctPartDtMeasureVos,e.useList=!1):(e.referGoodsName="",Object(i["a"])("该商品暂无可选尺码~"))}).then(function(){e.referGoodsId=a.id,e.canSelect=!0;var t={ids:e.measureClassInfoId,isGetList:!0};c["g"].getBodyData(t).then(function(t){if(t.length>0){var a={list:[]};t.forEach(function(t){a.name=t.gctMeasureHdName,a.referData=0,a.changeValue=0,a.actualData=0,a.masmeasureHdId=t.id,e.referSizeList.forEach(function(e){e.partDttMeasureVos[0].gctMeasureHdId===t.id&&(e.partDttMeasureVos[0].showData=!1,a.list.push(e.partDttMeasureVos[0]))}),e.referData.push(a),a={},a.list=[]})}})})}if(!0===t.hasOrder){e.referGoodsId=a.id,e.canSelect=!0;var o={ids:e.measureClassInfoId,isGetList:!0};c["g"].getBodyData(o).then(function(t){if(t.length>0){var a={list:[]};t.forEach(function(t){a.name=t.gctMeasureHdName,a.referData=0,a.changeValue=0,a.actualData=0,a.masmeasureHdId=t.id,e.referSizeList.forEach(function(e){e.partDttMeasureVos[0].gctMeasureHdId===t.id&&(e.partDttMeasureVos[0].showData=!1,a.list.push(e.partDttMeasureVos[0]))}),e.referData.push(a),a={},a.list=[]})}})}})})},choseSize:function(e){if(!1!==e.canSelect||e.referGoodsName)return!1===e.canSelect?(Object(i["a"])("数据正在加载中~"),void this.cancelSizePopup):!e.referSizeList||e.referSizeList.length<=0?(Object(i["a"])("该量体类别暂无参照尺码~"),void this.cancelSizePopup):(this.referSizeList=e.referSizeList,e.useList=!0,void(this.showSizeSelect=!0));Object(i["a"])("请先输入商品号~")},selectSize:function(e){this.msrTypeList.forEach(function(t){!0===t.useList&&t.referData.forEach(function(a){for(var s=0;s<e.partDttMeasureVos.length;s++)a.masmeasureHdId===e.partDttMeasureVos[s].gctMeasureHdId&&(a.referData=e.partDttMeasureVos[s].value,a.actualData=e.partDttMeasureVos[s].value,t.referGoodsSize=e.text,t.referGoodsSizeId=e.sizeId,t.showTable=!0,t.useList=!1)})}),this.showSizeSelect=!1},cancelSizePopup:function(){this.showSizeSelect=!1,this.referSizeList=[],this.msrTypeList.forEach(function(e){e.useList=!1})},saveMeasure:function(){var e=this;if(this.actualBodyData.length<=0&&this.actMsrTypeList.length<=0)Object(i["a"])("请先完善量体数据~");else{var t=!0,a={volumns:[]},s=[];this.actMsrTypeList.forEach(function(t){t.referGoodsSize&&(t.referData.forEach(function(e){e.range=e.actualData,e.standardValue=e.referData,e.measureValue=null}),!0===e.hasOrder?a.rtlOrdDtId=e.orderCode:a.rtlOrdDtId=t.ptiPartHdId||null,a.ptiPartHdId=t.referGoodsId||null,a.sizeId=t.referGoodsSizeId||null,a.msrModeTypeCode="D_REFMSR",a.measureClassInfoId=t.measureClassInfoId,a.volumns=t.referData,a.volumns.length>0&&s.push(a)),a={},a.volumns=[]});var r={},o=[];this.actualBodyData.forEach(function(e){-1===o.indexOf(e.measureClassInfoId)&&o.push(e.measureClassInfoId)});for(var n=0;n<o.length;n++){for(var l=0;l<this.actualBodyData.length;l++){var u=this.actualBodyData[l];u.measureClassInfoId===o[n]&&(u.value&&null!==u.value?(r.masmeasureHdId=u.id,r.measureValue=parseFloat(u.value),r.range=null,r.standardValue=null,a.volumns.push(r),r={},a.rtlOrdDtId=this.orderCode||null,a.msrModeTypeCode="D_ACTUALMSR",a.measureClassInfoId=u.measureClassInfoId):(Object(i["a"])("请先完善量体数据~"),t=!1))}s.push(a),a={},a.volumns=[]}if(!1!==t){var d={billCode:this.measureCode||null,dtRefs:s};c["g"].saveMeasure(d).then(function(t){t&&(Object(i["a"])("保存成功~"),e.$router.push("/measure-master/master-center"))})}}}},created:function(){this.saleCode=this.$route.query.saleCode,this.measureCode=this.$route.query.measureCode,this.orderCode=this.$route.query.orderCode,this.orderCode&&null!==this.orderCode&&-1===this.orderCode.indexOf("null")?(this.hasOrder=!0,this.getMsrType()):(this.hasOrder=!1,this.getDefaultMsrType())},computed:{actMsrTypeList:function(){var e=this,t=[];return this.msrTypeList.forEach(function(a){-1!==e.actTypeList.join(",").indexOf(a.measureClassInfoId)&&t.push(a)}),t}}},u=l,d=(a("ec4f"),a("2877")),f=Object(d["a"])(u,s,r,!1,null,"5d3fc6cd",null);f.options.__file="measure-data.vue";t["default"]=f.exports},8061:function(e,t,a){},ec4f:function(e,t,a){"use strict";var s=a("8061"),r=a.n(s);r.a}}]);